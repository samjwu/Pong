<html>

<canvas id="gamescreen" width="640" height="480"></canvas>

<head></head>

<body>
    
    <script>

    var canvas;
    var canvascontext;

    var paddlethickness = 5;
    var paddlelength = 100;
    var paddle1position = gamescreen.height/2 - paddlelength/2;
    var paddle2position = gamescreen.height/2 - paddlelength/2;
    var aispeed = 2;

    var balldimensions = 5;
    var ballxpos = gamescreen.width/2
    var ballypos = gamescreen.height/2;
    var ballxvelocity = 5;
    var ballyvelocity = 5;
    var bouncespeed = 0.3;

    var score1 = 0;
    var score2 = 0;


    window.onload = function() {
        console.log("Preparing Canvas...");

        canvas = document.getElementById("gamescreen");
        canvascontext = canvas.getContext("2d");

        var fps = 30;
        setInterval(function() {
            updatescreen();
            rungame();
        }, 1000/fps);

        canvas.addEventListener("mousemove", function(e) {
            paddle1position = e.clientY - paddlelength/2;
        });
    } 

    function resetscreen() {
        console.log("Screen Reset");

        ballxpos = canvas.width/2;
        ballypos = canvas.height/2;
        ballxvelocity = 5;
        ballyvelocity = 5;
    }

    function rungame() {
        ballxpos += ballxvelocity;
        ballypos += ballyvelocity;

        //bounce ball off walls
        if(ballypos < 0 && ballyvelocity < 0) {
            ballyvelocity = -ballyvelocity;
        }
        if(ballypos > canvas.height && ballyvelocity > 0) {
            ballyvelocity = -ballyvelocity;
        }

        //bounce ball off Player 1 paddle or score
        if(ballxpos < 0) {
            if(ballypos > paddle1position && ballypos < (paddle1position + paddlelength)) {
                ballxvelocity = -(bouncespeed + ballxvelocity);
                dy = ballypos - (paddle1position + paddlelength/2);
                ballyvelocity = bouncespeed * dy
            }
            else {
                score2++;
                resetscreen();
            }
        }
        
        //bounce ball off Player 2 paddle or score
        if(ballxpos > canvas.width) {
            if(ballypos>paddle2position && ballypos < (paddle2position + paddlelength)) {
                ballxvelocity = -(bouncespeed + ballxvelocity);
                dy = ballypos - (paddle2position + paddlelength/2);
                ballyvelocity = bouncespeed * dy
            }
            else {
                score1++;
                resetscreen();
            }
        }

        //move ai paddle
        if(ballypos > paddle2position + paddlelength/2) {
            paddle2position += aispeed;
        }
        else {
            paddle2position -= aispeed;
        }
    }

    //colors and draws rectangles
    function colorRect(x, y, width, height, color) {
        canvascontext.fillStyle = color;
        canvascontext.fillRect(x, y, width, height)
    }

    function updatescreen() {
        colorRect(0, 0, canvas.width, canvas.height, "black"); //gamescreen
        colorRect(canvas.width/2, 0, 1, canvas.height, "white"); //dividing line in middle
        colorRect(0, paddle1position, paddlethickness, paddlelength, "white"); //player paddle
        colorRect(canvas.width - paddlethickness, paddle2position, paddlethickness, paddlelength, "white"); //computer paddle

        canvascontext.fillStyle = "white";

        canvascontext.fillText(score1, canvas.width/4, 50);
        canvascontext.fillText(score2, canvas.width - canvas.width/4, 50);

        //draw ball
        canvascontext.fillStyle = "white";
        canvascontext.beginPath();
        canvascontext.arc(ballxpos - balldimensions/2, ballypos - balldimensions/2, balldimensions, 0, Math.PI * 2, true);
        canvascontext.fill();

        
    }

    // function updatescreen() {
    //     colorRect(0, 0, canvas.width, canvas.height, "black"); //gamescreen
    //     colorRect(canvas.width/2, 0, 1, canvas.height, "white"); //dividing line in middle
    //     colorRect(0, paddle1position, paddlethickness, paddlelength, "white"); //player paddle
    //     colorRect(canvas.width - paddlethickness, paddle2position, paddlethickness, paddlelength, "white"); //computer paddle
    //     // colorRect(ballxpos - balldimensions/2, ballypos - balldimensions/2, balldimensions, balldimensions, "white"); //ball

    //     //draw ball
    //     canvascontext.fillStyle = "white";
    //     canvascontext.beginPath();
    //     canvascontext.arc(ballxpos - balldimensions/2, ballypos - balldimensions/2, balldimensions, 0, Math.PI * 2, true);
    //     canvascontext.fill();

    //     canvascontext.fillStyle = "white";
    //     canvascontext.fillText(score1, canvas.width/4, 50);
    //     canvascontext.fillText(score2, canvas.width - canvas.width/4, 50);
    // }

    </script>

</body>